import 'dart:math';import 'package:intl/intl.dart';import 'package:flutter/material.dart';import 'package:qrscan/qrscan.dart' as scanner;import 'package:flutter/services.dart';import 'package:shahwan/Services/service.dart';import 'package:shahwan/Model/ProductTabel.dart';import 'package:shahwan/constants.dart';import 'package:shared_preferences/shared_preferences.dart';import 'package:flutter/cupertino.dart';import 'package:rflutter_alert/rflutter_alert.dart';import 'Database/sqlLite.dart';import 'package:font_awesome_flutter/font_awesome_flutter.dart';import 'dart:convert';import 'dart:async';import 'dart:io';import 'package:flutter/material.dart';import 'package:shahwan/Services/base.dart';import 'package:http/http.dart' as http ;import 'Homepage.dart';class Scanne extends StatefulWidget {  @override  _ScanneState createState() => _ScanneState();}class _ScanneState extends State<Scanne> {  var DataTabel1;  late List product_qty;  var Waerhous1=" ";  var alertStyle = AlertStyle(      alertPadding: EdgeInsets.only(top: 150, bottom: 150),      animationType: AnimationType.shrink,      isCloseButton: true,      isOverlayTapDismiss: true,      descStyle: TextStyle(fontWeight: FontWeight.w300, fontSize: 10),      animationDuration: Duration(milliseconds: 100),      alertBorder: RoundedRectangleBorder(        borderRadius: BorderRadius.circular(20.0),        side: BorderSide(          color: Colors.grey,        ),      ),      titleStyle: TextStyle(        color: Colors.red,      ),      constraints: BoxConstraints.expand(width: 300),      //First to chars "55" represents transparency of color      overlayColor: Color(0x55000000),      alertElevation: 10,      alertAlignment: Alignment.center);  var result;  DatabaseHelper db = DatabaseHelper();  get result1 => result;  void _scanQR() async {    try {      String? cameraScanResult = await scanner.scan();      // print("cameraScanResult" + cameraScanResult.toString());      var cameraScanResultNumber = cameraScanResult          .toString()          .substring(0, cameraScanResult.toString().indexOf('|'));      var cameraScanResultName = cameraScanResult.toString().substring(          cameraScanResult.toString().indexOf('|\$\$|') + 4,          cameraScanResult.toString().indexOf('-'));      // var  code = cameraScanResult.toString().split(' ');      // print("cameraScanResult>>>>>>>>" + cameraScanResultNumber.toString());      // print("cameraScanResultName >>>>>>" + cameraScanResultName.toString());      DateTime now = DateTime.now();      String formattedDate = DateFormat('dd/MM/yyyy').format(now);      var defaultCode = cameraScanResultNumber;      // var productUomQty = '1'.toString();      // db.SaveProduct(new ProductTabel(      //     name.toString(), defaultCode.toString(), productUomQty));      var data;      data = {        'database': 'shahwan',        'login': 'admin',        'OdooApi': 'sgsdsfdgfdbrberb',        'default_code':defaultCode ,      };      print("data" + data.toString());      // result = await Service("view_product").Post(data) as List<dynamic> ;      // print("result " + data.toString());      Post(Map body) async {        var url = Uri.parse("http://shahwan-qr.com:5000" + '/' +"view_product" );        print(url);        http.Response response = await http.post(url , headers: null , body: body );        // print("print(jsonEncode(body) );"+response.toString() );        if (response.statusCode == 200) {          var data = json.decode(response.body);          // print(" response.body;"+response.body.toString());          //  print( data.toString() );          List product_qty = data["data"][0]["product_qty"];          return product_qty;        } else {          return {};        }      };      result = await Post(data) ;      print("result " + result.toString());     //  print("result" + product_qty[0].toString());     //  print("result" + product_qty[1].toString());     // var roduct_qty = result["data"][0]["product_qty"];     //  // var result1 = result.data.["product_qty"] ;     //   print("result" + roduct_qty[0]["warehouse_id"].toString());     //  Waerhous1=roduct_qty[0]["warehouse_id"];     //  SharedPreferences prefs = await SharedPreferences.getInstance();     //  prefs.setString('Waerhous1',Waerhous1.toString());     //  print("prefs.getString(.toString()  >>>> " + prefs.getString("Waerhous1'")     //      .toString());      setState(() {      // List  result1=result!;      });    } on PlatformException catch (e) {      print(e);    }  }  // Future _send() async {  //   DateTime now = DateTime.now();  //   String formattedDate = DateFormat('dd/MM/yyyy').format(now);  //   var all = await db.getAllProducts();  //   print("ALL>>>>" + all.toString());  //   final prefs = await SharedPreferences.getInstance();  //   final shahwan = prefs.getString('shahwan');  //   final login = prefs.getString('UserName');  //   final OdooApi = prefs.getString('OdooApi');  //   var data;  //   data = {  //     'database': shahwan,  //     'login': "admin",  //     'OdooApi': "sgsdsfdgfdbrberb",  //     'date': formattedDate,  //     'qrcode_sale_form_line_ids':  //     '[{"default_code":"0001013073","product_uom_qty":10},{"default_code":"0001013075","product_uom_qty":4}]',  //   };  //   print("data >>>> " + data.toString());  //   data = await Service("qrcode_receive").Post(data);  //   print("result" + data.toString());  //   //{'message': 'Qrcode Sale Created', 'result': 'success', 'Reference': 450, 'new_qrcode_sale_id': '235'}  //   if (data['result'] == 'success') {  //     Alert(  //       context: context,  //       style: alertStyle,  //       title: "تمت العملية بنجاح ",  //       desc: "  الرقم المرجعي = ${data['Reference']}",  //       image: Image(  //           height: 60,  //           width: 60,  //           image: AssetImage("asset/images/success-icon-23187.png")),  //       buttons: [  //         DialogButton(  //           child: Text(  //             "تم",  //             style: TextStyle(color: Colors.white, fontSize: 20),  //           ),  //           onPressed: () => Navigator.pop(context),  //           color: ShahwanColor,  //           radius: BorderRadius.circular(20.0),  //         ),  //       ],  //     ).show();  //   } else {  //     Alert(  //       context: context,  //       style: alertStyle,  //       title: "حدث خطاء في الارسال",  //       desc: "  حاول التاكد من المدخلات",  //       image: Image(  //           height: 60,  //           width: 60,  //           image: AssetImage("asset/images/PngItem_6273493.png")),  //       buttons: [  //         DialogButton(  //           child: Text(  //             "تم",  //             style: TextStyle(color: Colors.white, fontSize: 20),  //           ),  //           onPressed: () => Navigator.pop(context),  //           color: ShahwanColor,  //           radius: BorderRadius.circular(20.0),  //         ),  //       ],  //     ).show();  //   }  // }  @override  void initState() {    super.initState();    db = DatabaseHelper();  }  @override  Widget build(BuildContext context) {    return Scaffold(      appBar: AppBar(        centerTitle: true,        backgroundColor: ShahwanColor,        titleSpacing: 20,        title: Text(" المواصفات والكميات "),        leading: new IconButton(            icon: new Icon(Icons.arrow_back_ios_outlined),            onPressed: () =>  Navigator.of(context).pushReplacement(                MaterialPageRoute(                    builder: (context) => HomePage()))        ),      ),      body: FutureBuilder(        future:result ,        builder: (context, AsyncSnapshot snapshot) {          if (!snapshot.hasData) {            return Center(              child: CircularProgressIndicator(),            );          } else {            return ListView.builder(                shrinkWrap: true,                physics: ScrollPhysics(),                itemCount: snapshot.data.length,                itemBuilder: (context, index) {                  // ProductTabel product =                  // ProductTabel.fromMap(snapshot.data[index]);                  return Container(                      width: MediaQuery.of(context).size.width,                      height: 100,                      child: Padding(                        padding:                        EdgeInsets.symmetric(horizontal: 10, vertical: 5),                        child: Ink(                            color: Colors.grey[100],                            child: ListTile(                                title: Row(                                  crossAxisAlignment: CrossAxisAlignment.center,                                  mainAxisAlignment: MainAxisAlignment.center,                                  children: [                                    Padding(                                      padding: const EdgeInsets.all(5.0),                                      child: Center(                                          child: Row(                                            children: [                                              SizedBox(                                                height: 20,                                                width: MediaQuery.of(context)                                                    .size                                                    .width /                                                    5,                                                child: FittedBox(                                                  fit: BoxFit.fitWidth,                                                  child: Text(                                                   snapshot.data[index].warehouse_id,                                                    textAlign: TextAlign.justify,                                                    style: TextStyle(                                                        color: Colors.black,                                                        fontStyle:                                                        FontStyle.normal),                                                  ),                                                ),                                              ),                                              SizedBox(                                                width: 15,                                              ),                                              // SizedBox(                                              //   height: 20,                                              //   width: MediaQuery.of(context)                                              //       .size                                              //       .width /                                              //       5,                                              //   child: FittedBox(                                              //     fit: BoxFit.fitWidth,                                              //     child: Text(                                              //       product.defaultCode,                                              //       textAlign: TextAlign.justify,                                              //       style: TextStyle(                                              //           color: Colors.black,                                              //           fontStyle:                                              //           FontStyle.normal),                                              //     ),                                              //   ),                                              // ),                                              // SizedBox(                                              //   width: 15,                                              // ),                                              // SizedBox(                                              //   height: 15,                                              //   width: MediaQuery.of(context)                                              //       .size                                              //       .width /                                              //       12,                                              //   child: FittedBox(                                              //     fit: BoxFit.contain,                                              //     child: Text(                                              //       product.productUomQty                                              //           .toString()!= null ? "${product.productUomQty}":"0",                                              //       textAlign: TextAlign.justify,                                              //       style: TextStyle(                                              //           color: Colors.red,                                              //           fontStyle:                                              //           FontStyle.normal),                                              //     ),                                              //   ),                                              // ),                                            ],                                          )),                                    )                                  ],                                ),                                trailing: IconButton(                                  icon: Icon(                                    Icons.edit_outlined,                                  ),                                  onPressed: () async {                                    showDialog(                                        context: context,                                        builder: (context) {                                          return Padding(                                            padding: const EdgeInsets.all(5.0),                                            child: AlertDialog(                                              elevation: 20,                                              scrollable: true,                                              actionsAlignment:                                              MainAxisAlignment.center,                                              clipBehavior: Clip.hardEdge,                                              title: Text('إضافة كمية'),                                              content: TextField(                                                keyboardType:                                                TextInputType.number,                                                inputFormatters: <                                                    TextInputFormatter>[                                                  FilteringTextInputFormatter                                                      .allow(RegExp(r'[0-9]')),                                                ],                                                onChanged: (value) {                                                  setState(() {                                                    // valueText = value;                                                  });                                                },                                                // controller:                                                // _textFieldController,                                                decoration: InputDecoration(                                                    hintText: "الكمية"),                                              ),                                              actions: <Widget>[                                                Padding(padding: EdgeInsets                                                    .all(10) ,                                                  child:Center(                                                    child: Container(                                                      height: 30,                                                      width: 100,                                                      decoration: BoxDecoration(                                                          color: Colors.white,                                                          borderRadius:                                                          BorderRadius                                                              .circular(30)),                                                      // child: FlatButton(                                                      //   color: ShahwanColor,                                                      //   textColor: Colors.white,                                                      //   child: Text('إضافة'),                                                      //   onPressed: () async {                                                      //     int qu ;                                                      //     qu =int.parse(_textFieldController.text)                                                      //     ;                                                      //     // if (qu == ) {                                                      //     //   qu =0;                                                      //     // }                                                      //     var id = index;                                                      //     db.updateCourse(                                                      //         ProductTabel(                                                      //             product.id,                                                      //             product.name,                                                      //             product                                                      //                 .defaultCode,                                                      //             qu.toInt()));                                                      //                                                      //     setState(() {                                                      //       _textFieldController                                                      //           .text = " ";                                                      //       Navigator.pop(                                                      //           context);                                                      //     });                                                      //   },                                                      // ),                                                    ),                                                  ),                                                )                                              ],                                            ),                                          );                                        });                                  },                                ))),                      ));                });          }        },      ),      // Padding(      //       padding: const EdgeInsets.all(35.0),      //       child: Column(      //         children: [      //           Container(      //             child: Text("مواصفات المنتج"),      //      //           ),      //           DataTable(      //             columns: const <DataColumn>[      //               DataColumn(      //      //                 label: Text(      //                   'المستودع',      //                   style: TextStyle(fontStyle: FontStyle.italic),      //      //                 ),      //               ),      //               DataColumn(      //                 label: Text(      //                   'الكميات',      //                   style: TextStyle(fontStyle: FontStyle.italic),      //                 ),      //               ),      //      //             ],      //             rows: const <DataRow>[      //               DataRow(      //                 cells: <DataCell>[      //                   DataCell(Text('Sarah')),      //                   DataCell(Text('19')),      //                 ],      //               ),      //               DataRow(      //                 cells: <DataCell>[      //                   DataCell(Text('Janine')),      //                   DataCell(Text('43')),      //                 ],      //               ),      //               DataRow(      //                 cells: <DataCell>[      //                   DataCell(Text('William')),      //                   DataCell(Text('27')),      //                 ],      //               ),      //             ],      //           ),      //         ],      //       ),      //     ),      floatingActionButtonLocation: FloatingActionButtonLocation.centerDocked,      floatingActionButton: Padding(        padding: const EdgeInsets.all(15.0),        child: Align(          alignment: Alignment.bottomCenter,          child: Container(            padding: EdgeInsets.only(top: 400, bottom: 10),            child: Row(              crossAxisAlignment: CrossAxisAlignment.center,              mainAxisAlignment: MainAxisAlignment.center,              children: <Widget>[                FloatingActionButton.extended(                  backgroundColor: ShahwanColor,                  onPressed: () {                    _scanQR();                    // calling a function when user click on button                  },                  icon: Icon(Icons.camera_alt_outlined),                  label: Text("مسح"),                ),              ],            ),          ),        ),      ),      // floatingActionButton: FloatingActionButton.extended(      //     icon: Icon(Icons.camera_alt),      //     onPressed: () {      //       _scanQR();      //      //       // calling a function when user click on button      //     },      //     label: Text("Scan")),      // floatingActionButtonLocation: FloatingActionButtonLocation.centerFloat,    );  }}