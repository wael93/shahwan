import 'dart:math';import 'package:intl/intl.dart';import 'package:flutter/material.dart';import 'package:qrscan/qrscan.dart' as scanner;import 'package:flutter/services.dart';import 'package:shahwan/Services/service.dart';import 'package:shahwan/Model/ProductTabel.dart';import 'package:shahwan/constants.dart';import 'package:shared_preferences/shared_preferences.dart';import 'package:flutter/cupertino.dart';import 'package:rflutter_alert/rflutter_alert.dart';import 'Database/sqlLite.dart';import 'package:font_awesome_flutter/font_awesome_flutter.dart';import 'Homepage.dart';class Scanne extends StatefulWidget {  @override  _ScanneState createState() => _ScanneState();}class _ScanneState extends State<Scanne> {  var DataTabel1;   late List result;  late List product_qty;  var Waerhous1=" ";  var alertStyle = AlertStyle(      alertPadding: EdgeInsets.only(top: 150, bottom: 150),      animationType: AnimationType.shrink,      isCloseButton: true,      isOverlayTapDismiss: true,      descStyle: TextStyle(fontWeight: FontWeight.w300, fontSize: 10),      animationDuration: Duration(milliseconds: 100),      alertBorder: RoundedRectangleBorder(        borderRadius: BorderRadius.circular(20.0),        side: BorderSide(          color: Colors.grey,        ),      ),      titleStyle: TextStyle(        color: Colors.red,      ),      constraints: BoxConstraints.expand(width: 300),      //First to chars "55" represents transparency of color      overlayColor: Color(0x55000000),      alertElevation: 10,      alertAlignment: Alignment.center);  DatabaseHelper db = DatabaseHelper();  Future _scanQR() async {    try {      String? cameraScanResult = await scanner.scan();      // print("cameraScanResult" + cameraScanResult.toString());      var cameraScanResultNumber = cameraScanResult          .toString()          .substring(0, cameraScanResult.toString().indexOf('|'));      var cameraScanResultName = cameraScanResult.toString().substring(          cameraScanResult.toString().indexOf('|\$\$|') + 4,          cameraScanResult.toString().indexOf('-'));      // var  code = cameraScanResult.toString().split(' ');      // print("cameraScanResult>>>>>>>>" + cameraScanResultNumber.toString());      // print("cameraScanResultName >>>>>>" + cameraScanResultName.toString());      DateTime now = DateTime.now();      String formattedDate = DateFormat('dd/MM/yyyy').format(now);      var defaultCode = cameraScanResultNumber;      // var productUomQty = '1'.toString();      // db.SaveProduct(new ProductTabel(      //     name.toString(), defaultCode.toString(), productUomQty));      var data;      data = {        'database': 'shahwan',        'login': 'admin',        'OdooApi': 'sgsdsfdgfdbrberb',        'default_code':defaultCode ,      };      print("data" + data.toString());     var  result = await Service("view_product").Post(data) ;      List product_qty = result["data"][0]["product_qty"];      print("result" + product_qty[0].toString());      print("result" + product_qty[1].toString());     var roduct_qty = result["data"][0]["product_qty"];      // var result1 = result.data.["product_qty"] ;       print("result" + roduct_qty[0]["warehouse_id"].toString());      setState(() {        Waerhous1=roduct_qty[0]["warehouse_id"];      });    } on PlatformException catch (e) {      print(e);    }  }  Future _send() async {    DateTime now = DateTime.now();    String formattedDate = DateFormat('dd/MM/yyyy').format(now);    var all = await db.getAllProducts();    print("ALL>>>>" + all.toString());    final prefs = await SharedPreferences.getInstance();    final shahwan = prefs.getString('shahwan');    final login = prefs.getString('UserName');    final OdooApi = prefs.getString('OdooApi');    var data;    data = {      'database': shahwan,      'login': "admin",      'OdooApi': "sgsdsfdgfdbrberb",      'date': formattedDate,      'qrcode_sale_form_line_ids':      '[{"default_code":"0001013073","product_uom_qty":10},{"default_code":"0001013075","product_uom_qty":4}]',    };    print("data >>>> " + data.toString());    data = await Service("qrcode_receive").Post(data);    print("result" + data.toString());    //{'message': 'Qrcode Sale Created', 'result': 'success', 'Reference': 450, 'new_qrcode_sale_id': '235'}    if (data['result'] == 'success') {      Alert(        context: context,        style: alertStyle,        title: "تمت العملية بنجاح ",        desc: "  الرقم المرجعي = ${data['Reference']}",        image: Image(            height: 60,            width: 60,            image: AssetImage("asset/images/success-icon-23187.png")),        buttons: [          DialogButton(            child: Text(              "تم",              style: TextStyle(color: Colors.white, fontSize: 20),            ),            onPressed: () => Navigator.pop(context),            color: ShahwanColor,            radius: BorderRadius.circular(20.0),          ),        ],      ).show();    } else {      Alert(        context: context,        style: alertStyle,        title: "حدث خطاء في الارسال",        desc: "  حاول التاكد من المدخلات",        image: Image(            height: 60,            width: 60,            image: AssetImage("asset/images/PngItem_6273493.png")),        buttons: [          DialogButton(            child: Text(              "تم",              style: TextStyle(color: Colors.white, fontSize: 20),            ),            onPressed: () => Navigator.pop(context),            color: ShahwanColor,            radius: BorderRadius.circular(20.0),          ),        ],      ).show();    }  }  @override  void initState() {    super.initState();    db = DatabaseHelper();  }  @override  Widget build(BuildContext context) {    return Scaffold(      appBar: AppBar(        centerTitle: true,        backgroundColor: ShahwanColor,        titleSpacing: 20,        title: Text(" المواصفات والكميات "),        leading: new IconButton(            icon: new Icon(Icons.arrow_back_ios_outlined),            onPressed: () =>  Navigator.of(context).pushReplacement(                MaterialPageRoute(                    builder: (context) => HomePage()))        ),      ),      body: Padding(            padding: const EdgeInsets.all(35.0),            child: Column(              children: [                Container(                  child: Text("مواصفات المنتج"),                ),                DataTable(                  columns: const <DataColumn>[                    DataColumn(                      label: Text(                        'المستودع',                        style: TextStyle(fontStyle: FontStyle.italic),                      ),                    ),                    DataColumn(                      label: Text(                        'الكميات',                        style: TextStyle(fontStyle: FontStyle.italic),                      ),                    ),                  ],                  rows: const <DataRow>[                    DataRow(                      cells: <DataCell>[                        DataCell(Text('Sarah')),                        DataCell(Text('19')),                      ],                    ),                    DataRow(                      cells: <DataCell>[                        DataCell(Text('Janine')),                        DataCell(Text('43')),                      ],                    ),                    DataRow(                      cells: <DataCell>[                        DataCell(Text('William')),                        DataCell(Text('27')),                      ],                    ),                  ],                ),              ],            ),          ),      floatingActionButtonLocation: FloatingActionButtonLocation.centerDocked,      floatingActionButton: Padding(        padding: const EdgeInsets.all(15.0),        child: Align(          alignment: Alignment.bottomCenter,          child: Container(            padding: EdgeInsets.only(top: 400, bottom: 10),            child: Row(              crossAxisAlignment: CrossAxisAlignment.center,              mainAxisAlignment: MainAxisAlignment.center,              children: <Widget>[                FloatingActionButton.extended(                  backgroundColor: ShahwanColor,                  onPressed: () {                    _scanQR();                    // calling a function when user click on button                  },                  icon: Icon(Icons.camera_alt_outlined),                  label: Text("مسح"),                ),              ],            ),          ),        ),      ),      // floatingActionButton: FloatingActionButton.extended(      //     icon: Icon(Icons.camera_alt),      //     onPressed: () {      //       _scanQR();      //      //       // calling a function when user click on button      //     },      //     label: Text("Scan")),      // floatingActionButtonLocation: FloatingActionButtonLocation.centerFloat,    );  }}